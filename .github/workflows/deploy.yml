name: ğŸµ Deploy OMÃºsicoCatÃ³lico

on:
  push:
    branches: [ main ]
    paths-ignore:
      - 'README.md'
      - '.gitignore'
      - 'docs/**'
  workflow_dispatch:  # Permite deploy manual via interface do GitHub

jobs:
  deploy:
    name: ğŸš€ Deploy to Production
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¦ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ” Show commit info
      run: |
        echo "ğŸ”„ Deploying commit: ${{ github.sha }}"
        echo "ğŸ‘¤ Author: ${{ github.actor }}"
        echo "ğŸ“ Message: ${{ github.event.head_commit.message }}"
        
    - name: ğŸ” Debug secrets
      run: |
        echo "HOST is set: ${{ secrets.HOST != '' }}"
        echo "USERNAME is set: ${{ secrets.USERNAME != '' }}"
        echo "SSH_KEY is set: ${{ secrets.SSH_KEY != '' }}"
        
    - name: ğŸš€ Deploy to server
      uses: appleboy/ssh-action@v1.1.0
      with:
        host: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        key: ${{ secrets.SSH_KEY }}
        port: 22
        debug: true
        script: |
          echo "ğŸµ Iniciando deploy do OMÃºsicoCatÃ³lico..."
          echo "ğŸ“… $(date '+%Y-%m-%d %H:%M:%S')"
          echo "ğŸ”„ Commit: ${{ github.sha }}"
          echo ""
          
          cd /var/www/omusicacatolico
          
          # Verificar se estÃ¡ no diretÃ³rio correto
          if [ ! -f "deploy.sh" ]; then
            echo "âŒ Erro: deploy.sh nÃ£o encontrado!"
            exit 1
          fi
          
          # Executar deploy
          ./deploy.sh
          
          echo ""
          echo "âœ… Deploy concluÃ­do com sucesso!"
          echo "ğŸµ OMÃºsicoCatÃ³lico estÃ¡ no ar!"
          
    - name: âœ… Notify success
      if: success()
      run: |
        echo "ğŸ‰ Deploy realizado com sucesso!"
        echo "ğŸŒ Site: https://omusicocatolico.com.br"
        
    - name: âŒ Notify failure
      if: failure()
      run: |
        echo "ğŸ’¥ Falha no deploy!"
        echo "ğŸ“‹ Verifique os logs acima para mais detalhes" 